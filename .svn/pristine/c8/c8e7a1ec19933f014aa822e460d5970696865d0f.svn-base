-- 创建教师信息视图start
DROP VIEW IF EXISTS v_teacher;
CREATE VIEW v_teacher AS 
SELECT 
t.teacherNo NO,u.account,u.name,u.password,u.sex,u.age,u.pid,t.role roleNo,r.name roleName,t.major majorNo,m.name majorName,t.state,m.deptNo,c.name deptName
FROM USER u, teacher t,major m ,CODE c,role r WHERE t.user = u.account AND t.major = m.majorNo AND m.deptNo = c.codeNo AND u.role = r.no

SELECT * FROM v_teacher;

--**********************************************************************************************************************
--**********************************************************************************************************************

-- 创建试卷教师关系视图start
DROP VIEW IF EXISTS v_paper_teacher;
CREATE VIEW v_paper_teacher AS SELECT p.paperNo,p.TYPE,p.description,p.startTime,p.endTime,t.teacherNo,t.name,t.role,t.major,t.state,m.deptNo dept
FROM paper p , (SELECT t.*,u.name FROM teacher t ,USER u WHERE t.user = u.account ) t,major m WHERE t.`major` = m.`majorNo`;

--**********************************************************************************************************************
--***********************************************************************************************************************

--创建学生视图
DROP VIEW IF EXISTS v_student;
CREATE VIEW v_student AS SELECT 
s.stuno NO,u.`account`,u.`NAME`,u.`PASSWORD`,u.`sex`,u.`age`,u.`pid`,s.`joinTime`,s.`overTime`,s.`classNo`,cl.`NAME` className,s.`role` roleNo,r.`name` roleName,
s.`major` majorNo,m.`name` majorName,s.`state`,m.`deptNo`,c.`NAME` deptName
FROM USER u, student s,major m ,CODE c,role r ,class cl
WHERE s.user = u.account AND s.major = m.majorNo AND m.deptNo = c.codeNo AND u.role = r.no AND s.classNo = cl.classNo;

--***********************************************************************************************************************
--**********************************************************************************************************************

-- 试卷详情信息视图（包括试卷信息、问题信息、选项信息）
DROP VIEW IF EXISTS v_paper;
CREATE VIEW v_paper AS
SELECT  pq.`paper` paperNo,p.type paperType,p.description,p.startTime,p.endTime, pq.`question` questionNo,pq.`number`,pq.`score`,q.`question` questionInfo, qo.`letter`,qo.`ratio`,qo.`optionNo`,o.`info` optionInfo
FROM paper_question pq , question_option qo, paper p,question q,optioninfo o 
WHERE pq.`question` = qo.`question` AND pq.`question` = q.`questionNO` AND pq.paper = p.paperNo AND qo.`optionNo` = o.`optionNo`
ORDER BY pq.`number`,qo.`letter`;